# A股市场综合分析系统说明书

## 📋 目录
1. [系统概述](#系统概述)
2. [文件结构说明](#文件结构说明)
3. [功能详解](#功能详解)
4. [使用指南](#使用指南)
5. [维护说明](#维护说明)
6. [常见问题](#常见问题)
7. [扩展开发](#扩展开发)

---

## 📖 系统概述

### 系统简介
本系统是一个基于GitHub Actions的自动化A股市场分析工具，能够自动收集市场数据、分析热点题材、判断市场情绪，并生成专业的分析报告。

### 核心功能
- ✅ **自动数据收集**：每日定时获取热门股票、市场话题、行业新闻
- ✅ **智能分析**：情感分析、题材热度计算、新闻关联分析
- ✅ **报告生成**：自动生成JSON和Markdown格式的分析报告
- ✅ **历史记录**：保存每日数据便于对比分析
- ✅ **在线浏览**：支持GitHub Pages在线查看

### 技术架构
- **运行平台**：GitHub Actions
- **编程语言**：Python 3.11
- **主要库**：requests, beautifulsoup4, pandas, snownlp
- **数据源**：东方财富、雪球、新浪财经等

---

## 📁 文件结构说明

```
Agu-analysis/
├── .github/
│   └── workflows/
│       └── collect_stock_news.yml    # GitHub Actions工作流配置
├── market_analyzer.py               # 核心分析脚本
├── README.md                        # 仓库首页展示
├── reports/                         # 分析报告存储目录
│   ├── comprehensive_report_YYYY-MM-DD.json  # JSON格式报告
│   └── comprehensive_report_YYYY-MM-DD.md    # Markdown格式报告
├── SYSTEM_GUIDE.md                 # 本说明书
├── .gitignore                      # Git忽略文件配置
└── requirements.txt                 # Python依赖包列表（可选）
```

### 各文件详细说明

#### 1. `.github/workflows/collect_stock_news.yml`
**作用**：定义自动化工作流程  
**功能**：
- 设置定时运行时间（每日9:00和15:00）
- 配置Python运行环境
- 安装必要依赖包
- 执行分析脚本
- 自动提交结果到仓库

**关键配置**：
```yaml
on:
  schedule:
    - cron: '0 1,7 * * 1-5'  # UTC时间，对应北京时间9:00和15:00
  workflow_dispatch:           # 允许手动触发
```

#### 2. `market_analyzer.py`
**作用**：系统的核心逻辑实现  
**包含的主要函数**：

| 函数名 | 功能描述 | 数据源 | 输出 |
|--------|----------|--------|------|
| `get_hot_stocks()` | 获取热门股票TOP10 | 东方财富API | 股票列表 |
| `get_hot_topics()` | 获取热门讨论话题 | 雪球、东方财富股吧 | 话题列表 |
| `analyze_sentiment()` | 分析市场情绪 | 话题数据 | 情感分析结果 |
| `get_hot_themes()` | 获取热点题材 | 概念板块、话题关键词 | 题材列表 |
| `analyze_theme_popularity()` | 分析题材热度 | 题材数据、新闻 | 热度排名 |
| `collect_industry_news()` | 收集行业新闻 | 新浪RSS、东方财富 | 新闻列表 |
| `generate_comprehensive_report()` | 生成分析报告 | 所有分析数据 | JSON/Markdown文件 |
| `main()` | 主函数，协调所有功能 | - | - |

#### 3. `README.md`
**作用**：仓库首页展示，提供快速概览  
**内容结构**：
- 最新市场报告日期
- 热门股票TOP3
- 市场情绪分析
- 热点题材TOP3
- 完整报告链接

#### 4. `reports/` 目录
**作用**：存储每日生成的分析报告  
**文件类型**：
- **JSON文件**：包含完整的数据结构，便于程序处理
- **Markdown文件**：格式化的可读报告，便于人工阅读

#### 5. `.gitignore`
**作用**：指定Git忽略的文件类型  
**典型内容**：
```
__pycache__/
*.pyc
.venv/
.env
```

---

## 🔧 功能详解

### 1. 数据收集功能

#### 热门股票收集
- **数据源**：东方财富API
- **获取内容**：
  - 股票代码、名称
  - 涨跌幅、最新价
  - 成交量、成交额
  - 市盈率、市值
- **更新频率**：每日9:00和15:00

#### 市场话题收集
- **数据源**：
  - 雪球热门话题
  - 东方财富股吧热门
- **获取内容**：
  - 话题标题
  - 发布用户
  - 评论/阅读数
  - 发布时间

#### 行业新闻收集
- **数据源**：
  - 新浪财经RSS
  - 东方财富行业新闻
- **获取内容**：
  - 新闻标题
  - 新闻摘要
  - 原文链接
  - 发布时间

### 2. 智能分析功能

#### 情感分析
- **技术**：使用SnowNLP库
- **分析对象**：市场话题内容
- **输出结果**：
  - 情感分数（0-1，越接近1越正面）
  - 分类（正面/中性/负面）
  - 市场效应判断（赚钱效应/亏钱效应）

#### 题材热度分析
- **分析维度**：
  - 出现次数（40%权重）
  - 平均涨幅（30%权重）
  - 相关新闻数（20%权重）
  - 数据源数量（10%权重）
- **热度公式**：
  ```
  热度分数 = 出现次数×0.4 + (平均涨幅/10)×0.3 + 新闻数×0.2 + 来源数×0.1
  ```

#### 新闻关联分析
- **关联逻辑**：将行业新闻与热点题材进行关键词匹配
- **输出结果**：每个题材的相关新闻列表

### 3. 报告生成功能

#### JSON格式报告
- **特点**：结构化数据，便于程序处理
- **用途**：数据分析、API调用、历史对比
- **包含内容**：所有原始数据和分析结果

#### Markdown格式报告
- **特点**：人类可读，格式美观
- **用途**：直接阅读、在线展示
- **包含内容**：
  - 热门股票表格
  - 市场情绪分析
  - 热点题材排名
  - 详细题材分析

---

## 📖 使用指南

### 1. 首次部署

#### 步骤1：创建GitHub仓库
1. 登录GitHub，创建新仓库
2. 设置为Public（免费使用GitHub Actions）
3. 勾选初始化选项

#### 步骤2：添加核心文件
1. 创建 `.github/workflows/collect_stock_news.yml`
2. 创建 `market_analyzer.py`
3. 创建 `README.md`

#### 步骤3：配置权限
1. 进入仓库Settings → Actions → General
2. 设置Workflow permissions为"Read and write"
3. 保存设置

#### 步骤4：测试运行
1. 进入Actions页面
2. 手动触发工作流
3. 检查运行结果

### 2. 日常使用

#### 查看最新分析
- **快速概览**：直接访问仓库主页查看README.md
- **详细分析**：进入reports目录查看当天的Markdown报告
- **数据研究**：查看JSON格式的完整数据

#### 手动更新数据
如果需要立即更新数据：
1. 点击仓库的Actions标签
2. 选择"A-Stock Market Analysis"
3. 点击"Run workflow"
4. 确认运行

#### 历史数据对比
1. 进入reports目录
2. 选择不同日期的报告
3. 对比分析市场变化

### 3. 高级功能

#### 启用GitHub Pages
1. 进入仓库Settings → Pages
2. 选择Deploy from a branch
3. Branch选择main，文件夹选择/(root)
4. 访问生成的在线页面

#### 设置邮件通知
1. 生成邮箱应用专用密码
2. 在仓库Secrets中添加邮箱配置
3. 修改工作流文件添加邮件通知步骤

---

## 🛠️ 维护说明

### 1. 定期检查项目

#### 每周检查
- 工作流是否正常运行
- 数据获取是否成功
- 报告生成是否完整

#### 每月检查
- 数据源是否有效
- 分析逻辑是否需要调整
- 依赖包是否需要更新

### 2. 常见维护任务

#### 更新数据源
如果某个数据源失效：
1. 在Actions日志中查看错误信息
2. 更新`market_analyzer.py`中的API地址
3. 测试新的数据源

#### 调整分析逻辑
如果需要修改分析算法：
1. 修改对应的分析函数
2. 调整权重或参数
3. 测试运行验证结果

#### 添加新功能
如果需要扩展功能：
1. 在`market_analyzer.py`中添加新函数
2. 在`main()`函数中调用
3. 更新报告生成逻辑

### 3. 性能优化

#### 减少运行时间
- 优化网络请求（添加缓存）
- 并行处理多个数据源
- 减少不必要的数据处理

#### 节省资源
- 避免频繁请求
- 合理设置超时时间
- 清理历史数据

---

## ❓ 常见问题

### 1. 运行失败问题

#### 问题：文件找不到
```
python: can't open file 'market_analyzer.py': [Errno 2] No such file or directory
```
**解决**：
- 确保文件在根目录，不在workflows文件夹下
- 检查文件名拼写正确
- 确认文件已成功提交到仓库

#### 问题：权限错误
```
Permission to xxx/xxx.git denied to github-actions[bot]
```
**解决**：
- 进入Settings → Actions → General
- 设置Workflow permissions为"Read and write"
- 修改工作流文件使用GITHUB_TOKEN

#### 问题：网络请求失败
```
requests.exceptions.Timeout / ConnectionError
```
**解决**：
- 增加请求超时时间
- 添加重试机制
- 检查数据源是否可用

### 2. 数据问题

#### 问题：获取的数据为空
**可能原因**：
- 数据源API变更
- 网站反爬限制
- 非交易时间无数据

**解决**：
- 检查API地址是否有效
- 添加User-Agent等请求头
- 确认在交易时间内运行

#### 问题：分析结果异常
**可能原因**：
- 数据格式变化
- 算法逻辑错误
- 特殊字符处理问题

**解决**：
- 检查数据解析逻辑
- 添加数据验证
- 增加错误处理

### 3. 报告问题

#### 问题：报告格式错误
**解决**：
- 检查报告生成函数
- 确保数据类型正确
- 添加格式验证

#### 问题：中文显示乱码
**解决**：
- 确保文件使用UTF-8编码
- 在Python文件开头添加编码声明
- 检查Markdown文件编码

---

## 🚀 扩展开发

### 1. 添加新数据源

#### 示例：添加同花顺数据
```python
def get_ths_data():
    """获取同花顺数据"""
    try:
        url = "http://data.10jqka.com.cn/market/longhu/"
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        }
        response = requests.get(url, headers=headers)
        # 解析数据逻辑
        return parsed_data
    except Exception as e:
        print(f"获取同花顺数据失败: {str(e)}")
        return []
```

### 2. 添加新的分析维度

#### 示例：添加资金流向分析
```python
def analyze_capital_flow(stock_data):
    """分析资金流向"""
    # 实现资金流向分析逻辑
    return analysis_result
```

### 3. 添加可视化功能

#### 示例：生成图表
```python
import matplotlib.pyplot as plt

def generate_charts(data):
    """生成分析图表"""
    plt.figure(figsize=(10, 6))
    # 绘制图表逻辑
    plt.savefig('reports/charts.png')
```

### 4. 添加通知功能

#### 示例：微信通知
```python
def send_wechat_notification(message):
    """发送微信通知"""
    # 实现微信通知逻辑
    pass
```

### 5. 添加数据存储

#### 示例：数据库存储
```python
import sqlite3

def save_to_database(data):
    """保存数据到数据库"""
    conn = sqlite3.connect('market_data.db')
    # 实现数据存储逻辑
    conn.close()
```

---

## 📞 技术支持

### 获取帮助
1. **查看日志**：Actions页面有详细的运行日志
2. **检查文档**：参考本说明书的常见问题部分
3. **搜索问题**：在GitHub Issues中搜索类似问题

### 贡献代码
1. Fork本仓库
2. 创建功能分支
3. 提交代码更改
4. 发起Pull Request

### 联系方式
- GitHub Issues：提交问题和建议
- Email：[你的邮箱地址]

---

## 📄 版本历史

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0 | 2025-08-20 | 初始版本，基础功能实现 |
| v1.1 | 待定 | 计划添加可视化功能 |
| v1.2 | 待定 | 计划添加更多数据源 |

---

*最后更新：2025-08-20*  
*维护者：[你的GitHub用户名]*
